const Dynamic=require("./../dbmodel/Dynamic"),Article=require("./../dbmodel/Article"),routerExports={};function getDynamic(n,t){return new Promise((a,t)=>{const o=[];Dynamic.find({content:n}).then(t=>{if(t){for(const c of t){var e=c.content,r=c.title,s=c._id,s={date:c.date,type:"动态",summary:e,title:r,_id:s};o.push(s)}Dynamic.find({title:n}).then(t=>{if(t){for(const c of t){var e=c.content,r=c.title,s=c._id,s={date:c.date,type:"动态",summary:e,title:r,_id:s};o.push(s)}a(o)}})}else a([])}).catch(t=>{a([])})})}function getArticle(e,o){return new Promise((c,t)=>{const a=[];Article.find({summary:e}).then(t=>{if(t){for(const s of t){var e=s.summary.indexOf(o),r=s.summary.slice(e,e+o.length+100),e=s._id,e={date:s.year+"-"+s.date,type:"文章",summary:r,_id:e};a.push(e)}c(a)}else c([])}).catch(t=>{c([])})})}function getArticle1(e,t){return new Promise((c,t)=>{const a=[];Article.find({summary:e}).then(t=>{if(t){for(const s of t){var e=s.summary,r=s._id,r={date:s.year+"-"+s.date,type:"文章",summary:e,_id:r};a.push(r)}c(a)}else c([])}).catch(t=>{c([])})})}routerExports.search1={method:"post",url:"/search1",route:async(e,t)=>{var{data:r}=e.request.body,s=new RegExp(r+"|(\\b"+r+"\\b)");try{const a=await getDynamic(s,r);var c=await getArticle1(s,r);e.body={success:!0,result:a.concat(c)}}catch(t){e.body={success:!1,errorMsg:t}}}},routerExports.search={method:"post",url:"/search",route:async(e,t)=>{var{data:r}=e.request.body,s=new RegExp(r+"|(\\b"+r+"\\b)");try{const a=await getDynamic(s,r);var c=await getArticle(s,r);e.body={success:!0,result:a.concat(c)}}catch(t){e.body={success:!1,errorMsg:t}}}},module.exports=routerExports;