const Path=require("path"),{readFile}=require("../common/util"),{CACHE_REG,NO_CACHE_API}=require("../common/constant");module.exports=async(e,t)=>{try{const{request:{path:o,header:r},response:s}=e;if(CACHE_REG.test(o)){var a=r["if-modified-since"];const c=await readFile(Path.resolve(`./public${o}`));var i=c.mtime.toGMTString();i===a?s.status=304:s.lastModified=i}else NO_CACHE_API.includes(o)||e.set("Cache-Control","public,max-age=600")}catch(e){console.log("cache-error",e)}finally{await t()}};