const{ADMIN_API,USER_API}=require("../common/constant"),User=require("../dbmodel/User"),{parseToken,reMapError}=require("../common/util");module.exports=async(e,r)=>{await r();try{var{request:{url:o,headers:{authorization:a}}}=e;if(ADMIN_API.includes(o)||USER_API.includes(o)){var i=ADMIN_API.includes(o),s=parseToken(a);if(!s)throw"会话过期";var t=await User.findOne({_id:s._id});if(!t)throw"用户不存在";if(i&&!t.admin)throw"当前用户无权限"}}catch(r){e.body={success:!1,errorMsg:reMapError(r),errorStack:r}}};