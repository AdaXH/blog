(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"4bX+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.relativetime=function(e){if(/ /.test(e))return(0,u.default)(e).startOf("minute").fromNow();return(0,u.default)(new Date(Number(e))).format("YYYY-MM-DD HH:mm:ss")};var n,r=a("yq+b"),u=(n=r)&&n.__esModule?n:{default:n};u.default.lang("zh-cn")},PIZI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(a("GZet"));a("u0nm");var r=l(a("q+fq")),u=l(a("zyh/"));function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.total,a=e.pageSize,l=e.current,s=void 0===l?1:l,c=e.onChange;return r.default.createElement("div",{className:u.default.pageCon},r.default.createElement(n.default,{total:t,pageSize:a,current:s,onChange:c}))}},"dx+2":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=b(a("xMca")),r=b(a("bS4n")),u=b(a("cLjf")),l=b(a("hDQ3")),s=b(a("+XIM"));a("LAXG");var c=a("q+fq"),d=b(c),f=a("LneV"),i=b(a("4E9k")),o=a("LalF"),p=a("lwPf"),m=a("f23f"),g=a("jYk1"),v=b(a("PIZI")),h=b(a("cPCf")),E=b(a("ZvZb")),M=b(a("gXF2")),y=b(a("l4+c")),_=a("nrsQ"),N=a("hwUi"),k=b(a("jK5N"));function b(e){return e&&e.__esModule?e:{default:e}}t.default=(0,f.connect)((function(e){return{user:e.user}}))((function(e){var t,a=(t=(0,l.default)(u.default.mark((function e(){var t,a,n,r,l,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;return u.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="message-"+s,a=(0,m.getCache)(t),X.current&&(X.current.scrollTop=0),a?(T(a),I(s)):h.default.show(),e.next=6,(0,g.getAllMessage)({page:s,pageSize:N.MAX_PAGE_COUNT});case 6:(n=e.sent).success&&(r=n.totalCount,l=n.data,(0,m.hasChange)(a,l)&&((0,m.setCache)(t,U),T(l),(0,m.setCache)(t,l),q(r),I(s),h.default.hide()));case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)}),f=e.dispatch,b=e.user,w=(0,c.useState)(1),x=(0,s.default)(w,2),C=x[0],I=x[1],D=(0,c.useState)(!i.default.get("user")),R=(0,s.default)(D,2),O=R[0],j=R[1],P=(0,c.useState)((0,m.getCache)("totalCount")||6),S=(0,s.default)(P,2),L=S[0],q=S[1],A=(0,c.useState)((0,m.getCache)("message-"+C)||[]),Y=(0,s.default)(A,2),U=Y[0],T=Y[1],X=(0,c.useRef)({});(0,c.useEffect)((function(){(0,m.setCache)("totalCount",L)}),[L]),(0,p.useDidMount)((0,l.default)(u.default.mark((function e(){return u.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a();case 3:return e.next=5,f({type:"user/getUserInfo",payload:{}});case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,void 0,[[0,7]])}))));var Z=function(){a()},z=function(e,t){T(U.map((function(a){return a._id===e&&(a.repeat=t),(0,r.default)({},a)})))},B=b.isLogin&&i.default.get("user"),H={textAlign:B?"center":"left",lineHeight:B?"50px":"unset",width:B?"unset,":"100%"};return d.default.createElement("div",{className:k.default.messageContainer},d.default.createElement(y.default,{data:U}),d.default.createElement("div",{className:k.default.wrapContainer,onClick:function(e){return t=e.nativeEvent.target,void(/wrapContainer+|addMsgCon/.test(t.className)&&f({type:"message/init"}));var t}},d.default.createElement("div",{className:k.default.addMsgCon},d.default.createElement("div",{className:k.default.dot}),d.default.createElement("div",{className:k.default.dotToLine}),d.default.createElement("div",{className:k.default.dotToLine2}),d.default.createElement("div",{className:k.default.addMsg},d.default.createElement("span",{style:H,className:k.default.replayEntry,onClick:function(){var e,t,n,s;O||B?(e="leaveMsg",t=!B&&O,s=(0,l.default)(u.default.mark((function l(s){var c,d,p;return u.default.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(s&&""!==s.trim()){u.next=4;break}E.default.fail({msg:"输入不规范"}),u.next=22;break;case 4:if("leaveMsg"!==e){u.next=21;break}return c=(0,_.escapeData)(s),d={},t||(d.name=b.name||o.Base64.decode(i.default.get("user"))),u.next=10,(0,g.leaveMessage)((0,r.default)({date:Date.now(),content:c},d,{quickReply:t}));case 10:if(!(p=u.sent).success){u.next=18;break}return u.next=14,a(1);case 14:return u.next=16,f({type:"dialog/hide"});case 16:u.next=19;break;case 18:E.default.fail({msg:p.errorMsg||p||"留言失败"});case 19:u.next=22;break;case 21:"repeat"===e&&f({type:"message/repeatMsg",payload:{_id:t,info:(0,_.escapeData)(s),toRepeat:n}}).then((function(e){!e.success&&E.default.fail({msg:e}),e.success&&f({type:"dialog/hide"})}));case 22:case"end":return u.stop()}}),l,void 0)}))),f({type:"dialog/open",payload:{placeholder:"repeat"===e?"回复"+n+": ":"在这里写下留言",cb:function(e){return s.apply(this,arguments)},maxInput:100}})):E.default.fail({msg:"请先登录或勾选快捷留言"})}},"点击留言"),!B&&d.default.createElement(n.default,{className:k.default.quick,checked:O,onChange:function(e){e.stopPropagation(),j(e.target.checked)}},"快捷留言，无需登录"))),d.default.createElement("div",{className:k.default.messageListWrap},d.default.createElement("ul",{className:k.default.mssageList,ref:X},U.map((function(e,t){return d.default.createElement(M.default,{item:e,index:t,key:e._id,user:b,deleteMsgCallback:Z,dispatch:f,updateRepeat:z})})))),d.default.createElement("div",{className:k.default.pagination},U.length&&d.default.createElement(v.default,{total:L,pageSize:N.MAX_PAGE_COUNT,current:C,onChange:function(e){return a(e)}}))))}))},gXF2:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=p(a("cLjf")),r=p(a("hDQ3")),u=p(a("+XIM")),l=p(a("q+fq")),s=a("HJ5N"),c=p(a("ZvZb")),d=p(a("ga3y")),f=a("jYk1"),i=a("nrsQ"),o=p(a("jK5N"));function p(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.item,a=e.dispatch,p=e.deleteMsgCallback,m=e.updateRepeat,g=e.user,v=e.index,h=(0,s.useSetState)({showOperation:!1,showRepeat:!1}),E=(0,u.default)(h,2),M=E[0],y=E[1],_=M.showOperation,N=M.showRepeat;function k(){if(!g.isLogin)return c.default.fail({msg:"请先登录~"}),!0}var b,w=(b=(0,r.default)(n.default.mark((function e(t){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,f.deleteMsgById)({_id:t});case 4:e.sent.success&&p(t);case 6:case"end":return e.stop()}}),e,void 0)}))),function(e){return b.apply(this,arguments)}),x=function(e,t,u){if("null"!==u){if(!k()){var l,s=(l=(0,r.default)(n.default.mark((function r(l){var s,d;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l&&""!==l.trim()){n.next=4;break}c.default.fail({msg:"输入不规范"}),n.next=8;break;case 4:return n.next=6,(0,f.repeatMsg)({_id:e,info:(0,i.escapeData)(l),toRepeat:t,toRepeatId:u});case 6:(s=n.sent).success?(a({type:"dialog/hide"}),d=s.data.repeat,m(e,d)):c.default.fail({msg:s.errorMsg});case 8:case"end":return n.stop()}}),r,void 0)}))),function(e){return l.apply(this,arguments)});a({type:"dialog/open",payload:{placeholder:"回复"+t+": ",cb:s,maxInput:100}})}}else c.default.fail({msg:"不能回复快捷评论~"})};return l.default.createElement("li",{className:o.default.messageItem,style:{animationDelay:.07*v+"s"}},l.default.createElement("div",{className:o.default.msgAvatar},l.default.createElement("img",{src:t.avatar,alt:""})),l.default.createElement("div",{className:o.default.mssageName},l.default.createElement("div",{className:o.default.leaveInfo},l.default.createElement("div",null,l.default.createElement("span",null,t.name),l.default.createElement("span",{className:o.default.msgDate},(0,i.renderDate)(t.date))))),l.default.createElement("div",{className:o.default.msgContent},t.content,l.default.createElement("div",{className:o.default.moreCon},l.default.createElement("div",{onClick:function(){return y({showRepeat:!N})}},l.default.createElement("span",{className:o.default.count},t.repeat.length),l.default.createElement("i",{className:"iconfont "+(N?"icon-quxiao":"icon-zhankai")})),l.default.createElement("div",{onClick:function(){return y({showOperation:!_})}},_?"Close":"More")),_&&l.default.createElement("div",{className:o.default.msgOperation},l.default.createElement("div",{onClick:function(){return x(t._id,t.name,t.userId)}},l.default.createElement("i",{className:"iconfont icon-liuyan-A"})),l.default.createElement("div",{onClick:function(){return w(t._id)}},l.default.createElement("i",{className:"iconfont icon-shanchu"})))),N&&t.repeat&&l.default.createElement(d.default,{list:t.repeat,parentId:t._id,leaveMsg:x,updateRepeat:m}))}},ga3y:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=m(a("cLjf")),r=m(a("hDQ3")),u=m(a("+XIM")),l=m(a("bS4n")),s=m(a("YReu")),c=a("q+fq"),d=m(c),f=m(a("ZvZb")),i=a("jYk1"),o=a("4bX+"),p=m(a("jK5N"));function m(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.list,a=(0,s.default)(e,["list"]);return t.length?d.default.createElement("ul",{className:p.default.repeatList},t.map((function(e,t){return d.default.createElement(g,(0,l.default)({index:t,item:e,key:e._id},a))}))):d.default.createElement("div",{className:p.default.repeatList},d.default.createElement("span",{className:p.default.repeatItem},"empty ~ "))};var g=function(e){var t,a=e.item,l=e.parentId,s=e.leaveMsg,m=e.updateRepeat,g=e.index,v=(0,c.useState)(!1),h=(0,u.default)(v,2),E=h[0],M=h[1],y=(t=(0,r.default)(n.default.mark((function e(t){var a,r=t._id,u=t.userId;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.deleteInnerRepeat)({_id:r,_parent_id:l,toRepeatUserId:u});case 2:(a=e.sent).success?m(l,a.data):f.default.fail({msg:a.errorMsg});case 4:case"end":return e.stop()}}),e,void 0)}))),function(e){return t.apply(this,arguments)}),_=a.toRepeatUser?a.toRepeatUser.name:a.toRepeat,N={animationDelay:.15*g+"s"};return d.default.createElement("li",{key:a._id,className:p.default.repeatItem,style:N},d.default.createElement("div",{className:p.default.repeatInfo},d.default.createElement("img",{src:a.avatar,alt:""}),d.default.createElement("div",{className:p.default.nameInfo},d.default.createElement("span",null,a.name," @ ",_),d.default.createElement("span",null,(0,o.relativetime)(a.date)))),d.default.createElement("div",{className:p.default.repeatContent},a.info,d.default.createElement("div",{onClick:function(){return M(!E)},className:p.default.more},E?"Close":"More")),E&&d.default.createElement("div",{className:p.default.msgOperation},d.default.createElement("div",{onClick:function(){return s(l,a.name,a.userId)}},d.default.createElement("i",{className:"iconfont icon-liuyan-A"})),d.default.createElement("div",{onClick:function(){return y(a)}},d.default.createElement("i",{className:"iconfont icon-shanchu"}))))}},hwUi:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MAX_PAGE_COUNT=10,t.FLY_USERS=["Ada","lin-blog"]},jYk1:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteInnerRepeat=t.repeatMsg=t.deleteMsgById=t.leaveMessage=void 0;var n,r,u,l,s=f(a("cLjf")),c=f(a("hDQ3"));t.leaveMessage=(n=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.default)("api/leaveMsg","POST",t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),t.deleteMsgById=(r=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.default)("api/deleteMsgById","POST",t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)}),t.repeatMsg=(u=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.default)("api/repeatmsg","POST",t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)}),t.deleteInnerRepeat=(l=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.default)("api/deleteInnerRepeat","POST",t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)});t.getAllMessage=function(e){return(0,d.default)("api/getAllMessage","POST",e)};var d=f(a("t3Un"));function f(e){return e&&e.__esModule?e:{default:e}}},"l4+c":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(a("q+fq")),r=u(a("jK5N"));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.data;return t.length?n.default.createElement("div",{className:r.default.flyMsgContainer},t.slice(0,3).map((function(e,t){return n.default.createElement("div",{key:t,style:{animationDuration:20+t+"s"},className:r.default.msgFlyItem},e.content)}))):null}},nrsQ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escapeData=function(e){return e.replace(/<input\stype="text"\sdata-formula="e=mc\^2"\sdata-link="quilljs\.com"\sdata-video="Embed\sURL"\splaceholder="Embed\sURL">/g,"").replace(/<\/?script>+|傻逼+|爸爸+|你爸+|SB+|sB+|sb+|操+|你妈/g,"**")},t.getDate=function(){var e=new Date,t=e.getMinutes(),a=t<10?"0"+t:t,n=e.getHours(),r=n<10?"0"+n:n,u=e.getFullYear(),l=e.getMonth()+1,s=l<10?"0"+l:l,c=e.getDate();return u+"-"+s+"-"+(c<10?"0"+c:c)+"-----"+r+" : "+a},t.renderDate=function(e){return/-/.test(e)?e.replace(/-----/," "):(0,u.default)(new Date(Number(e))).format("YYYY-MM-DD HH:mm:ss")};var n,r=a("yq+b"),u=(n=r)&&n.__esModule?n:{default:n};u.default.lang("zh-cn")}}]);